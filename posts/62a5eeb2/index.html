<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>jvm垃圾回收知识汇总 | 精进马大使</title><meta name="description" content="jvm垃圾回收知识汇总"><meta name="keywords" content="jvm,垃圾回收器"><meta name="author" content="精进马大使"><meta name="copyright" content="精进马大使"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://jskblog.xyz/posts/62a5eeb2/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="jvm垃圾回收知识汇总"><meta name="twitter:description" content="jvm垃圾回收知识汇总"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg"><meta property="og:type" content="article"><meta property="og:title" content="jvm垃圾回收知识汇总"><meta property="og:url" content="http://jskblog.xyz/posts/62a5eeb2/"><meta property="og:site_name" content="精进马大使"><meta property="og:description" content="jvm垃圾回收知识汇总"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="jvm区域划分及存放数据" href="http://jskblog.xyz/posts/1a869dfe/"><link rel="next" title="java对象内存计算" href="http://jskblog.xyz/posts/a1f3afe4/"><meta name="baidu-site-verification" content="&lt;meta name=&quot;baidu-site-verification&quot; content=&quot;m0FTCFBXUY&quot; /&gt;"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: {"languages":{"author":"作者: 精进马大使","link":"链接: http://jskblog.xyz/posts/62a5eeb2/","source":"来源: 精进马大使","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  copy_copyright_js: true
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">精进马大使</a></span><i class="fa fa-bars fa-fw toggle-menu pull-right close" aria-hidden="true"></i><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主目录</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章列表</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lozad avatar_img" src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@v1.1/photos/shikai.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">36</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">35</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主目录</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章列表</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#垃圾回收区域"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">垃圾回收区域</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#垃圾回收标记法"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">垃圾回收标记法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#程序计数算法"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">程序计数算法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#可达性分析算法"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">可达性分析算法</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#垃圾回收时机"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">垃圾回收时机</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#元空间"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">元空间</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#无用类"><span class="toc_mobile_items-number">3.1.1.</span> <span class="toc_mobile_items-text">无用类</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#堆区"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">堆区</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#新生代"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">新生代</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#老年代"><span class="toc_mobile_items-number">3.2.2.</span> <span class="toc_mobile_items-text">老年代</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#内存空间为什么会满"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">内存空间为什么会满</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#元空间-1"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">元空间</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#堆区-1"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">堆区</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#新生代-1"><span class="toc_mobile_items-number">4.2.1.</span> <span class="toc_mobile_items-text">新生代</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#老年代-1"><span class="toc_mobile_items-number">4.2.2.</span> <span class="toc_mobile_items-text">老年代</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#引用"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">引用</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#强引用"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">强引用</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#软引用"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">软引用</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#弱应用"><span class="toc_mobile_items-number">5.3.</span> <span class="toc_mobile_items-text">弱应用</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#虚引用"><span class="toc_mobile_items-number">5.4.</span> <span class="toc_mobile_items-text">虚引用</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#垃圾回收术语"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">垃圾回收术语</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#内存溢出和内存泄露"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">内存溢出和内存泄露</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#内存溢出"><span class="toc_mobile_items-number">7.1.</span> <span class="toc_mobile_items-text">内存溢出</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#内存泄露"><span class="toc_mobile_items-number">7.2.</span> <span class="toc_mobile_items-text">内存泄露</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#垃圾回收算法"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">垃圾回收算法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#标记-清除-算法"><span class="toc_mobile_items-number">8.1.</span> <span class="toc_mobile_items-text">标记-清除 算法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#算法思想"><span class="toc_mobile_items-number">8.1.1.</span> <span class="toc_mobile_items-text">算法思想</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#优劣"><span class="toc_mobile_items-number">8.1.2.</span> <span class="toc_mobile_items-text">优劣</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#应用场景"><span class="toc_mobile_items-number">8.1.3.</span> <span class="toc_mobile_items-text">应用场景</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#复制-算法"><span class="toc_mobile_items-number">8.2.</span> <span class="toc_mobile_items-text">复制 算法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#算法思想-1"><span class="toc_mobile_items-number">8.2.1.</span> <span class="toc_mobile_items-text">算法思想</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#优劣势"><span class="toc_mobile_items-number">8.2.2.</span> <span class="toc_mobile_items-text">优劣势</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#应用场景-1"><span class="toc_mobile_items-number">8.2.3.</span> <span class="toc_mobile_items-text">应用场景</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#标记-整理-算法"><span class="toc_mobile_items-number">8.3.</span> <span class="toc_mobile_items-text">标记-整理 算法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#算法思想-2"><span class="toc_mobile_items-number">8.3.1.</span> <span class="toc_mobile_items-text">算法思想</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#优劣势-1"><span class="toc_mobile_items-number">8.3.2.</span> <span class="toc_mobile_items-text">优劣势</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#分代算法"><span class="toc_mobile_items-number">8.4.</span> <span class="toc_mobile_items-text">分代算法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#算法思想-3"><span class="toc_mobile_items-number">8.4.1.</span> <span class="toc_mobile_items-text">算法思想</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#具体流程"><span class="toc_mobile_items-number">8.4.2.</span> <span class="toc_mobile_items-text">具体流程</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#垃圾回收器"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text">垃圾回收器</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#垃圾回收考虑的问题"><span class="toc_mobile_items-number">9.1.</span> <span class="toc_mobile_items-text">垃圾回收考虑的问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#吞吐量"><span class="toc_mobile_items-number">9.1.1.</span> <span class="toc_mobile_items-text">吞吐量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#响应时间"><span class="toc_mobile_items-number">9.1.2.</span> <span class="toc_mobile_items-text">响应时间</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#java-8-默认回收器"><span class="toc_mobile_items-number">9.2.</span> <span class="toc_mobile_items-text">java 8 默认回收器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#新生代垃圾回收器"><span class="toc_mobile_items-number">9.3.</span> <span class="toc_mobile_items-text">新生代垃圾回收器</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#serial"><span class="toc_mobile_items-number">9.3.1.</span> <span class="toc_mobile_items-text">serial</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简单介绍"><span class="toc_mobile_items-number">9.3.1.1.</span> <span class="toc_mobile_items-text">简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#适用场景"><span class="toc_mobile_items-number">9.3.1.2.</span> <span class="toc_mobile_items-text">适用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#参数设置"><span class="toc_mobile_items-number">9.3.1.3.</span> <span class="toc_mobile_items-text">参数设置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#工作流程"><span class="toc_mobile_items-number">9.3.1.4.</span> <span class="toc_mobile_items-text">工作流程</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#parnew"><span class="toc_mobile_items-number">9.3.2.</span> <span class="toc_mobile_items-text">parnew</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简单介绍-1"><span class="toc_mobile_items-number">9.3.2.1.</span> <span class="toc_mobile_items-text">简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#适用场景-1"><span class="toc_mobile_items-number">9.3.2.2.</span> <span class="toc_mobile_items-text">适用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#参数设置-1"><span class="toc_mobile_items-number">9.3.2.3.</span> <span class="toc_mobile_items-text">参数设置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#工作流程-1"><span class="toc_mobile_items-number">9.3.2.4.</span> <span class="toc_mobile_items-text">工作流程</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#parallel-scavenge"><span class="toc_mobile_items-number">9.3.3.</span> <span class="toc_mobile_items-text">parallel scavenge</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简单介绍-2"><span class="toc_mobile_items-number">9.3.3.1.</span> <span class="toc_mobile_items-text">简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#适用场景-2"><span class="toc_mobile_items-number">9.3.3.2.</span> <span class="toc_mobile_items-text">适用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#参数设置-2"><span class="toc_mobile_items-number">9.3.3.3.</span> <span class="toc_mobile_items-text">参数设置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#工作流程-2"><span class="toc_mobile_items-number">9.3.3.4.</span> <span class="toc_mobile_items-text">工作流程</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#老年代垃圾回收器"><span class="toc_mobile_items-number">9.4.</span> <span class="toc_mobile_items-text">老年代垃圾回收器</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#serial-old"><span class="toc_mobile_items-number">9.4.1.</span> <span class="toc_mobile_items-text">serial old</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简单介绍-3"><span class="toc_mobile_items-number">9.4.1.1.</span> <span class="toc_mobile_items-text">简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#适用场景-3"><span class="toc_mobile_items-number">9.4.1.2.</span> <span class="toc_mobile_items-text">适用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#工作流程-3"><span class="toc_mobile_items-number">9.4.1.3.</span> <span class="toc_mobile_items-text">工作流程</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#parallel-old"><span class="toc_mobile_items-number">9.4.2.</span> <span class="toc_mobile_items-text">parallel old</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简单介绍-4"><span class="toc_mobile_items-number">9.4.2.1.</span> <span class="toc_mobile_items-text">简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#适用场景-4"><span class="toc_mobile_items-number">9.4.2.2.</span> <span class="toc_mobile_items-text">适用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#参数设置-3"><span class="toc_mobile_items-number">9.4.2.3.</span> <span class="toc_mobile_items-text">参数设置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#工作流程-4"><span class="toc_mobile_items-number">9.4.2.4.</span> <span class="toc_mobile_items-text">工作流程</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cms"><span class="toc_mobile_items-number">9.4.3.</span> <span class="toc_mobile_items-text">cms</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简单介绍-5"><span class="toc_mobile_items-number">9.4.3.1.</span> <span class="toc_mobile_items-text">简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#适用场景-5"><span class="toc_mobile_items-number">9.4.3.2.</span> <span class="toc_mobile_items-text">适用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#参数设置-4"><span class="toc_mobile_items-number">9.4.3.3.</span> <span class="toc_mobile_items-text">参数设置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#工作流程-5"><span class="toc_mobile_items-number">9.4.3.4.</span> <span class="toc_mobile_items-text">工作流程</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#G1"><span class="toc_mobile_items-number">9.4.4.</span> <span class="toc_mobile_items-text">G1</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#简单介绍-6"><span class="toc_mobile_items-number">9.4.4.1.</span> <span class="toc_mobile_items-text">简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#适用场景-6"><span class="toc_mobile_items-number">9.4.4.2.</span> <span class="toc_mobile_items-text">适用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#工作流程-6"><span class="toc_mobile_items-number">9.4.4.3.</span> <span class="toc_mobile_items-text">工作流程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#G1垃圾回收过程"><span class="toc_mobile_items-number">9.4.4.4.</span> <span class="toc_mobile_items-text">G1垃圾回收过程</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#垃圾回收区域"><span class="toc-number">1.</span> <span class="toc-text">垃圾回收区域</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#垃圾回收标记法"><span class="toc-number">2.</span> <span class="toc-text">垃圾回收标记法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#程序计数算法"><span class="toc-number">2.1.</span> <span class="toc-text">程序计数算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可达性分析算法"><span class="toc-number">2.2.</span> <span class="toc-text">可达性分析算法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#垃圾回收时机"><span class="toc-number">3.</span> <span class="toc-text">垃圾回收时机</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#元空间"><span class="toc-number">3.1.</span> <span class="toc-text">元空间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#无用类"><span class="toc-number">3.1.1.</span> <span class="toc-text">无用类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#堆区"><span class="toc-number">3.2.</span> <span class="toc-text">堆区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#新生代"><span class="toc-number">3.2.1.</span> <span class="toc-text">新生代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#老年代"><span class="toc-number">3.2.2.</span> <span class="toc-text">老年代</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内存空间为什么会满"><span class="toc-number">4.</span> <span class="toc-text">内存空间为什么会满</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#元空间-1"><span class="toc-number">4.1.</span> <span class="toc-text">元空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#堆区-1"><span class="toc-number">4.2.</span> <span class="toc-text">堆区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#新生代-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">新生代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#老年代-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">老年代</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#引用"><span class="toc-number">5.</span> <span class="toc-text">引用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#强引用"><span class="toc-number">5.1.</span> <span class="toc-text">强引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#软引用"><span class="toc-number">5.2.</span> <span class="toc-text">软引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#弱应用"><span class="toc-number">5.3.</span> <span class="toc-text">弱应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#虚引用"><span class="toc-number">5.4.</span> <span class="toc-text">虚引用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#垃圾回收术语"><span class="toc-number">6.</span> <span class="toc-text">垃圾回收术语</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内存溢出和内存泄露"><span class="toc-number">7.</span> <span class="toc-text">内存溢出和内存泄露</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#内存溢出"><span class="toc-number">7.1.</span> <span class="toc-text">内存溢出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内存泄露"><span class="toc-number">7.2.</span> <span class="toc-text">内存泄露</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#垃圾回收算法"><span class="toc-number">8.</span> <span class="toc-text">垃圾回收算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#标记-清除-算法"><span class="toc-number">8.1.</span> <span class="toc-text">标记-清除 算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#算法思想"><span class="toc-number">8.1.1.</span> <span class="toc-text">算法思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优劣"><span class="toc-number">8.1.2.</span> <span class="toc-text">优劣</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景"><span class="toc-number">8.1.3.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#复制-算法"><span class="toc-number">8.2.</span> <span class="toc-text">复制 算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#算法思想-1"><span class="toc-number">8.2.1.</span> <span class="toc-text">算法思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优劣势"><span class="toc-number">8.2.2.</span> <span class="toc-text">优劣势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景-1"><span class="toc-number">8.2.3.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标记-整理-算法"><span class="toc-number">8.3.</span> <span class="toc-text">标记-整理 算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#算法思想-2"><span class="toc-number">8.3.1.</span> <span class="toc-text">算法思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优劣势-1"><span class="toc-number">8.3.2.</span> <span class="toc-text">优劣势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分代算法"><span class="toc-number">8.4.</span> <span class="toc-text">分代算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#算法思想-3"><span class="toc-number">8.4.1.</span> <span class="toc-text">算法思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#具体流程"><span class="toc-number">8.4.2.</span> <span class="toc-text">具体流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#垃圾回收器"><span class="toc-number">9.</span> <span class="toc-text">垃圾回收器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#垃圾回收考虑的问题"><span class="toc-number">9.1.</span> <span class="toc-text">垃圾回收考虑的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#吞吐量"><span class="toc-number">9.1.1.</span> <span class="toc-text">吞吐量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#响应时间"><span class="toc-number">9.1.2.</span> <span class="toc-text">响应时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-8-默认回收器"><span class="toc-number">9.2.</span> <span class="toc-text">java 8 默认回收器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#新生代垃圾回收器"><span class="toc-number">9.3.</span> <span class="toc-text">新生代垃圾回收器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#serial"><span class="toc-number">9.3.1.</span> <span class="toc-text">serial</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单介绍"><span class="toc-number">9.3.1.1.</span> <span class="toc-text">简单介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景"><span class="toc-number">9.3.1.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#参数设置"><span class="toc-number">9.3.1.3.</span> <span class="toc-text">参数设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流程"><span class="toc-number">9.3.1.4.</span> <span class="toc-text">工作流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parnew"><span class="toc-number">9.3.2.</span> <span class="toc-text">parnew</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单介绍-1"><span class="toc-number">9.3.2.1.</span> <span class="toc-text">简单介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-1"><span class="toc-number">9.3.2.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#参数设置-1"><span class="toc-number">9.3.2.3.</span> <span class="toc-text">参数设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流程-1"><span class="toc-number">9.3.2.4.</span> <span class="toc-text">工作流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parallel-scavenge"><span class="toc-number">9.3.3.</span> <span class="toc-text">parallel scavenge</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单介绍-2"><span class="toc-number">9.3.3.1.</span> <span class="toc-text">简单介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-2"><span class="toc-number">9.3.3.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#参数设置-2"><span class="toc-number">9.3.3.3.</span> <span class="toc-text">参数设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流程-2"><span class="toc-number">9.3.3.4.</span> <span class="toc-text">工作流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#老年代垃圾回收器"><span class="toc-number">9.4.</span> <span class="toc-text">老年代垃圾回收器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#serial-old"><span class="toc-number">9.4.1.</span> <span class="toc-text">serial old</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单介绍-3"><span class="toc-number">9.4.1.1.</span> <span class="toc-text">简单介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-3"><span class="toc-number">9.4.1.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流程-3"><span class="toc-number">9.4.1.3.</span> <span class="toc-text">工作流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parallel-old"><span class="toc-number">9.4.2.</span> <span class="toc-text">parallel old</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单介绍-4"><span class="toc-number">9.4.2.1.</span> <span class="toc-text">简单介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-4"><span class="toc-number">9.4.2.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#参数设置-3"><span class="toc-number">9.4.2.3.</span> <span class="toc-text">参数设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流程-4"><span class="toc-number">9.4.2.4.</span> <span class="toc-text">工作流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cms"><span class="toc-number">9.4.3.</span> <span class="toc-text">cms</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单介绍-5"><span class="toc-number">9.4.3.1.</span> <span class="toc-text">简单介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-5"><span class="toc-number">9.4.3.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#参数设置-4"><span class="toc-number">9.4.3.3.</span> <span class="toc-text">参数设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流程-5"><span class="toc-number">9.4.3.4.</span> <span class="toc-text">工作流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G1"><span class="toc-number">9.4.4.</span> <span class="toc-text">G1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单介绍-6"><span class="toc-number">9.4.4.1.</span> <span class="toc-text">简单介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-6"><span class="toc-number">9.4.4.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流程-6"><span class="toc-number">9.4.4.3.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#G1垃圾回收过程"><span class="toc-number">9.4.4.4.</span> <span class="toc-text">G1垃圾回收过程</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">jvm垃圾回收知识汇总</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-03-08<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-03-08</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/jvm/">jvm</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/jvm/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8/">垃圾回收器</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">5.1k</span><span class="post-meta__separator">|</span><span>阅读时长: 15 分钟</span><span class="post-meta__separator">|</span><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="垃圾回收区域"><a href="#垃圾回收区域" class="headerlink" title="垃圾回收区域"></a>垃圾回收区域</h1><p>上篇了解到jvm的内存区域有 堆区、程序计数器、虚拟机栈、本地方法栈、方法区，而会进行垃圾回收的区域是：<code>堆区和元空间</code>。而如果元空间没有设置值，则不会有垃圾回收。</p>
<p>因为虚拟机栈在程序结束后会自己出栈，内存就是释放了。</p>
<h1 id="垃圾回收标记法"><a href="#垃圾回收标记法" class="headerlink" title="垃圾回收标记法"></a>垃圾回收标记法</h1><p>我们知道只有堆区和方法区会进行垃圾回收，那在垃圾回收的时候，到底回收什么东西呢？垃圾的定义是什么呢？</p>
<p>在jvm中，没有被引用的对象就可以标记为非存活对象，而非存活对象就是垃圾。</p>
<p>那我们该如何判断对象是否存活？有两个算法：</p>
<h2 id="程序计数算法"><a href="#程序计数算法" class="headerlink" title="程序计数算法"></a>程序计数算法</h2><p>给对象添加一个引用计数器，每当有一个地方引用时就+1，引用失效时-1。对象计数器等于0，则为非存活对象。</p>
<p>优点：实现简单、判断效率高<br>缺点：很难解决循环引用问题</p>
<h2 id="可达性分析算法"><a href="#可达性分析算法" class="headerlink" title="可达性分析算法"></a>可达性分析算法</h2><p>gc root 对象作为起始点，从这些节点向下搜索，所走的路径称作引用链，不在引用链中的对象则为非存活对象</p>
<p>gc root的对象有（对应的引用就是根节点，由存活的引用出发）：</p>
<ol>
<li>虚拟机栈的栈帧的局部变量表所引用的对象；</li>
<li>本地方法栈的JNI所引用的对象；</li>
<li>静态变量和常量所引用的对象；</li>
</ol>
<p>可达性分析过程如下图：</p>
<p><img alt="可达性分析过程" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/gc_root.png" class="lozad"></p>
<p>优点：精确严谨<br>缺点：会导致stw，stw的原因在确保引用关系不会变化</p>
<h1 id="垃圾回收时机"><a href="#垃圾回收时机" class="headerlink" title="垃圾回收时机"></a>垃圾回收时机</h1><p>上面了解到什么时垃圾，那我们会在什么时候进行垃圾的回收？</p>
<p>最开始我们讲过，主要进行垃圾回收的地方是：</p>
<ol>
<li>元空间</li>
<li>堆区</li>
</ol>
<p>所以当这两个区域满了，我们就会进行垃圾回收</p>
<h2 id="元空间"><a href="#元空间" class="headerlink" title="元空间"></a>元空间</h2><p>主要回收一部分垃圾：</p>
<ol>
<li>无用类</li>
</ol>
<blockquote>
<p>注意java8的常量和静态常量在堆里生成</p>
</blockquote>
<h3 id="无用类"><a href="#无用类" class="headerlink" title="无用类"></a>无用类</h3><p>满足以下几点则为无用类：</p>
<ol>
<li>该类所有实例都被回收</li>
<li>该类的classloader被回收</li>
<li>类class对象没有被引用，无法通过反射访问该类</li>
</ol>
<h2 id="堆区"><a href="#堆区" class="headerlink" title="堆区"></a>堆区</h2><p>堆区触发时机需要考虑两个区域：</p>
<ol>
<li>新生代</li>
<li>老年代</li>
</ol>
<h3 id="新生代"><a href="#新生代" class="headerlink" title="新生代"></a>新生代</h3><p>新生对象无法放入Eden区</p>
<h3 id="老年代"><a href="#老年代" class="headerlink" title="老年代"></a>老年代</h3><p>有几种情况：</p>
<ol>
<li>老年代空间放不下新生代对象</li>
<li>老年代空间小于每次minor gc后进入老年代的平均大小（空间担保机制，需要开启-XX:-HandlePromotionFailure）</li>
<li>通过参数设置，可以在老年代剩余空间少于92%时进行垃圾回收（CMS的一个参数调整）</li>
</ol>
<h1 id="内存空间为什么会满"><a href="#内存空间为什么会满" class="headerlink" title="内存空间为什么会满"></a>内存空间为什么会满</h1><p>我们现在知道什么时候会进行垃圾回收，但我们很好奇，内存区域到底是怎么满的？</p>
<h2 id="元空间-1"><a href="#元空间-1" class="headerlink" title="元空间"></a>元空间</h2><p>方法区满的主要原因是加载的类太多，并且一直无法释放，导致类加载累积。</p>
<h2 id="堆区-1"><a href="#堆区-1" class="headerlink" title="堆区"></a>堆区</h2><h3 id="新生代-1"><a href="#新生代-1" class="headerlink" title="新生代"></a>新生代</h3><p>一直有新生对象进入新生代。新生代的垃圾回收算法 是复制算法，所以效率很高。一般的优化都是希望垃圾尽可能在新生代进行完成。</p>
<h3 id="老年代-1"><a href="#老年代-1" class="headerlink" title="老年代"></a>老年代</h3><p>老年代的垃圾回收算法为 标记整理算法，并且老年代的存活对象较多，会导致垃圾回收比较耗时，所以我们更多时候是希望不要让垃圾回收在老年代进行。</p>
<p>而jvm整个数据流程是先通过新生代 然后再放入老年代，所以老年代的数据都是新生代传递过来的，传递的条件主要有：</p>
<ol>
<li>超过年龄（默认15）</li>
<li>minor gc后无法放入存活区</li>
<li>minor gc后各年龄的存活对象大小比存活区50%大（动态年龄判断）</li>
<li>大对象直接进入老年代。参数-XX:PretenureSizeThreshold设置，默认值为0。parnew和serial的垃圾回收器才有效果。</li>
</ol>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>在讲 gc root的时候，我们讲过引用链，在引用的世界里，有四种引用需要我们记住</p>
<h2 id="强引用"><a href="#强引用" class="headerlink" title="强引用"></a>强引用</h2><p>强引用是普遍存在引用，强引用的对象不会被回收</p>
<h2 id="软引用"><a href="#软引用" class="headerlink" title="软引用"></a>软引用</h2><p>发生内存溢出异常前，会进行回收，如果还是内存溢出则 oom。可用作内存敏感的高速缓存：数据会更新，内存不足我可以回收重新读取<br>（用软引用的方法构建的对象）</p>
<h2 id="弱应用"><a href="#弱应用" class="headerlink" title="弱应用"></a>弱应用</h2><p>无论内存是否足够，垃圾回收都会进行回收<br>（用弱引用的方法构建的对象）</p>
<h2 id="虚引用"><a href="#虚引用" class="headerlink" title="虚引用"></a>虚引用</h2><p>无论内存是否足够，垃圾回收都会进行回收<br>（用虚引用的方法构建的对象）</p>
<h1 id="垃圾回收术语"><a href="#垃圾回收术语" class="headerlink" title="垃圾回收术语"></a>垃圾回收术语</h1><p>关于垃圾回收，有几个术语需要记住：</p>
<ol>
<li>minor gc：新生代的垃圾回收，一般存活对象少，收集很快</li>
<li>old gc：老年代的垃圾回收</li>
<li>full gc：整个jvm区的垃圾回收，等于minor gc + old gc + 方法区gc</li>
<li>mixed gc：老年代超过45%，新生代和老年代进行混合gc（这是g1的垃圾回收术语）</li>
</ol>
<h1 id="内存溢出和内存泄露"><a href="#内存溢出和内存泄露" class="headerlink" title="内存溢出和内存泄露"></a>内存溢出和内存泄露</h1><p>经过上面的垃圾回收，正常情况下程序会重新拥有足够内存进行运算，但也会有特殊情况，导致内存一致无法回收到可以正常使用，这种情况程序就会抛出异常。而导致内存不够的主要有两种情况：</p>
<ol>
<li>内存溢出</li>
<li>内存泄露</li>
</ol>
<h2 id="内存溢出"><a href="#内存溢出" class="headerlink" title="内存溢出"></a>内存溢出</h2><p>内存溢出就是我们常说的oom，关于oom的汇总可以查看</p>
<h2 id="内存泄露"><a href="#内存泄露" class="headerlink" title="内存泄露"></a>内存泄露</h2><p>内存泄露指的是无用对象无法被垃圾回收，导致内存浪费，严重时会造成OOM。</p>
<p>java内存泄露的主要原因是：长生命周期的对象持有短生命周期对象引用。即：</p>
<ol>
<li>gc root对象可达</li>
<li>对象无用</li>
</ol>
<p>产生内存泄露的原因有：</p>
<ol>
<li>静态集合类引起内存泄露</li>
<li>各种连接（譬如jdbc没有关闭connection）</li>
<li>监听器</li>
<li>hash算法的集合，修改属性值无法进行remove</li>
</ol>
<h1 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h1><p>在介绍垃圾回收器前，我们先介绍下都有哪些垃圾回收算法，以及优劣</p>
<h2 id="标记-清除-算法"><a href="#标记-清除-算法" class="headerlink" title="标记-清除 算法"></a>标记-清除 算法</h2><h3 id="算法思想"><a href="#算法思想" class="headerlink" title="算法思想"></a>算法思想</h3><ol>
<li>标记阶段：标记出需要垃圾回收的对象</li>
<li>清除阶段：统一回收（清除）需要回收的对象</li>
</ol>
<blockquote>
<p>标记阶段会进行两次，具体步骤可查看上面的可达性图解</p>
</blockquote>
<p><img alt="标记-清除 算法" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/mark_clear.webp" class="lozad"></p>
<h3 id="优劣"><a href="#优劣" class="headerlink" title="优劣"></a>优劣</h3><ul>
<li>优势：算法简单，实现简单</li>
<li>劣势：<ul>
<li>分为标记和清除两个阶段，过程效率都不高</li>
<li>会产生空间垃圾碎片，导致内存不连续，可能导致有内存对象却无法分配的问题，浪费资源</li>
</ul>
</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>垃圾回收行为低 的场景</p>
<blockquote>
<p>老年代适合该算法，因为回收频率低，利用率高，效率和空间问题不明显</p>
</blockquote>
<h2 id="复制-算法"><a href="#复制-算法" class="headerlink" title="复制 算法"></a>复制 算法</h2><h3 id="算法思想-1"><a href="#算法思想-1" class="headerlink" title="算法思想"></a>算法思想</h3><ol>
<li>把内存划分为两块，每次只使用其中一块</li>
<li>当使用的这块内存用完，就将这块内存上还存活的对象复制到另一块没使用的内存上</li>
<li>然后把使用过的内存清除</li>
</ol>
<p><img alt="复制 算法" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jvm_copy.webp" class="lozad"></p>
<h3 id="优劣势"><a href="#优劣势" class="headerlink" title="优劣势"></a>优劣势</h3><ul>
<li>优势：<ul>
<li>解决标记清除效率问题</li>
<li>内存碎片问题</li>
</ul>
</li>
<li>劣势：<ul>
<li>内存需要空出一部分用于复制存活数据</li>
<li>如果存活对象多，复制频繁会影响效率</li>
</ul>
</li>
</ul>
<h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><p>存活对象少&amp;需要频繁垃圾回收 的区域</p>
<blockquote>
<p>新生代符合</p>
</blockquote>
<h2 id="标记-整理-算法"><a href="#标记-整理-算法" class="headerlink" title="标记-整理 算法"></a>标记-整理 算法</h2><h3 id="算法思想-2"><a href="#算法思想-2" class="headerlink" title="算法思想"></a>算法思想</h3><ol>
<li>标记阶段：标记需要需要回收的对象</li>
<li>整理阶段：让存活的对象移到一边</li>
<li>清除阶段：一次性清除端外的所有对象</li>
</ol>
<p><img alt="标记整理 算法" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/mark_clear_collect.webp" class="lozad"></p>
<h3 id="优劣势-1"><a href="#优劣势-1" class="headerlink" title="优劣势"></a>优劣势</h3><ul>
<li>优势：<ul>
<li>一次性把端外对象都清除</li>
<li>解决内存碎片问题</li>
</ul>
</li>
</ul>
<h2 id="分代算法"><a href="#分代算法" class="headerlink" title="分代算法"></a>分代算法</h2><p>主流虚拟机都用这种算法，即把上面的垃圾回收算法优劣势进行利用</p>
<h3 id="算法思想-3"><a href="#算法思想-3" class="headerlink" title="算法思想"></a>算法思想</h3><ol>
<li>新生代用的复制算法，但不把内存进行对半分，而是分成三份，比例默认为8:1:1</li>
</ol>
<blockquote>
<p>因为新生代的对象存活率低，所以可以如此划分三部分，充分利用复制算法效率</p>
</blockquote>
<ol start="2">
<li>老年代主要用的标记整理</li>
</ol>
<h3 id="具体流程"><a href="#具体流程" class="headerlink" title="具体流程"></a>具体流程</h3><p>我们结合上面的所有知识点，进行一次真实的对象迁移过程</p>
<blockquote>
<p>前提，堆区划分为新生代和老年代，新生代分Eden、from survivor、to survivor。新生代和老年代比例 1：2</p>
</blockquote>
<ul>
<li>对象首先进入Eden区</li>
<li>Eden区内存不足，进行minor gc，利用<code>复制算法</code>垃圾回收，把Eden存活对象复制到from survior区域，清除Eden区垃圾对象</li>
<li>对象继续进入Eden区，当Eden区又满时，进行minor gc，把Eden区和from survivor区存活对象移到to survivor区域</li>
<li>当出现以下情况时，把对象移到老年代<ul>
<li>超过年龄（默认15）</li>
<li>minor gc后无法放入存活区</li>
<li>minor gc后各年龄的存活对象大小比存活区50%大（动态年龄判断）</li>
<li>大对象直接进入老年代。参数-XX:PretenureSizeThreshold设置，默认值为0。parnew和serial的垃圾回收器才有效果。</li>
</ul>
</li>
<li>对象依旧按照对象先进Eden区的规范去进行，当老年代满了以后，就进行full gc，full gc的基本算法就是标记整理算法<code>（但不同的垃圾回收器有不同的优化和应用场景）</code>，而进行full gc的条件有以下：<ul>
<li>老年代空间放不下新生代对象</li>
<li>老年代空间小于每次minor gc后进入老年代的平均大小（空间担保机制，需要开启-XX:-HandlePromotionFailure）</li>
<li>通过参数设置，可以在老年代剩余空间少于92%时进行垃圾回收（CMS的一个参数调整）</li>
</ul>
</li>
</ul>
<h1 id="垃圾回收器"><a href="#垃圾回收器" class="headerlink" title="垃圾回收器"></a>垃圾回收器</h1><h2 id="垃圾回收考虑的问题"><a href="#垃圾回收考虑的问题" class="headerlink" title="垃圾回收考虑的问题"></a>垃圾回收考虑的问题</h2><p>主要有三点：</p>
<ol>
<li>吞吐量</li>
<li>响应时间</li>
<li>内存大小</li>
</ol>
<h3 id="吞吐量"><a href="#吞吐量" class="headerlink" title="吞吐量"></a>吞吐量</h3><p>吞吐量 = 运行用户代码时间/（运行用户代码时间+垃圾收集时间）</p>
<p>适合场景为：后台服务</p>
<h3 id="响应时间"><a href="#响应时间" class="headerlink" title="响应时间"></a>响应时间</h3><p>响应时间即停顿时间，停顿时间越短，用户体验越好</p>
<p>适合场景为：用户交互服务</p>
<h2 id="java-8-默认回收器"><a href="#java-8-默认回收器" class="headerlink" title="java 8 默认回收器"></a>java 8 默认回收器</h2><p>在介绍垃圾回收器前，想给大家确认java8默认的垃圾回收器。那我们应该如何查看呢？</p>
<p>可以在有java8的机器上输入</p>
<blockquote>
<p>java -XX:+PrintFlagsFinal -version</p>
</blockquote>
<p><img alt="默认垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/garbage_collection_v1.png" class="lozad"></p>
<p><img alt="默认垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/garbage_collection.png" class="lozad"></p>
<blockquote>
<p>关于内容查看，= 代表默认值，:= 代表修改过的值</p>
</blockquote>
<p>看图我们知道java8 默认的垃圾回收器为 Parallel GC，具体每个回收器对应的细节回收器如下图：</p>
<table>
<thead>
<tr>
<th>垃圾回收器</th>
<th>新生代</th>
<th>老年代</th>
</tr>
</thead>
<tbody><tr>
<td>G1GC</td>
<td>G1New</td>
<td>G1Old</td>
</tr>
<tr>
<td>Parallel GC</td>
<td>ParallelScavenge</td>
<td>ParallelOld(-UseParallelOld则是SerialOld)</td>
</tr>
<tr>
<td>CMS</td>
<td>ParNew</td>
<td>ConcurrentMarkSweep</td>
</tr>
<tr>
<td>Serial GC</td>
<td>DefNew</td>
<td>SerialOld</td>
</tr>
<tr>
<td>Epsilon</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>ZGC</td>
<td>N/A</td>
<td>Z</td>
</tr>
<tr>
<td>Shenandoah</td>
<td>N/A</td>
<td>Shenandoah</td>
</tr>
</tbody></table>
<p><code>关于每个具体回收器的介绍，我们看下面</code></p>
<h2 id="新生代垃圾回收器"><a href="#新生代垃圾回收器" class="headerlink" title="新生代垃圾回收器"></a>新生代垃圾回收器</h2><blockquote>
<p>新生代垃圾回收机制都采用 复制算法</p>
</blockquote>
<h3 id="serial"><a href="#serial" class="headerlink" title="serial"></a>serial</h3><h4 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h4><ul>
<li>并发收集</li>
</ul>
<blockquote>
<p>即单线程交替执行，在进行垃圾回收时会停止其他工作线程，该行为叫stop the world，简称stw</p>
</blockquote>
<ul>
<li>效率高</li>
</ul>
<blockquote>
<p>对于限定单CPU环境来说，Serial收集器没有线程交互开销（专一做垃圾收集），拥有更高的单线程收集效率。</p>
</blockquote>
<h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><p>客户端模式下，虚拟机的 新生代区域</p>
<h4 id="参数设置"><a href="#参数设置" class="headerlink" title="参数设置"></a>参数设置</h4><pre><code>-XX:+UseSerialGC：添加该参数来显式的使用串行垃圾收集器；</code></pre><h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><p><img alt="serial垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/serial_collection.webp" class="lozad"></p>
<h3 id="parnew"><a href="#parnew" class="headerlink" title="parnew"></a>parnew</h3><h4 id="简单介绍-1"><a href="#简单介绍-1" class="headerlink" title="简单介绍"></a>简单介绍</h4><ul>
<li>ParNew垃圾收集器是Serial收集器的多线程版本</li>
</ul>
<blockquote>
<p>由于存在线程交互的开销，所以在单CPU环境下，性能差于 Serial收集器</p>
</blockquote>
<ul>
<li>与CMS收集器配合工作</li>
</ul>
<blockquote>
<p>目前只有parnew可以与cms（老年代收集器）做搭配</p>
</blockquote>
<h4 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h4><p>server端新生代的多线程收集</p>
<h4 id="参数设置-1"><a href="#参数设置-1" class="headerlink" title="参数设置"></a>参数设置</h4><pre><code>-XX:+UseConcMarkSweepGC：指定使用CMS后，会默认使用ParNew作为新生代收集器；

-XX:+UseParNewGC：强制指定使用ParNew；    

-XX:ParallelGCThreads：指定垃圾收集的线程数量，ParNew默认开启的收集线程与CPU的数量相同；</code></pre><h4 id="工作流程-1"><a href="#工作流程-1" class="headerlink" title="工作流程"></a>工作流程</h4><p><img alt="parnew垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/parnew_collection.webp" class="lozad"></p>
<h3 id="parallel-scavenge"><a href="#parallel-scavenge" class="headerlink" title="parallel scavenge"></a>parallel scavenge</h3><h4 id="简单介绍-2"><a href="#简单介绍-2" class="headerlink" title="简单介绍"></a>简单介绍</h4><ul>
<li>具备parnew的多线程收集特点</li>
<li>该收集器以提高吞吐量为目的（关于吞吐量介绍上面）</li>
<li>自适应</li>
</ul>
<blockquote>
<p>会根据系统运行情况自动调整参数，如果莫名对象不入新生代而进入老年代，可能就是这个参数的设置原因。这是parnew和par scavenge最大差别</p>
</blockquote>
<h4 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h4><p>高吞吐为目标的系统服务</p>
<h4 id="参数设置-2"><a href="#参数设置-2" class="headerlink" title="参数设置"></a>参数设置</h4><pre><code>-XX:MaxGCPauseMillis：控制最大垃圾收集停顿时间，大于0的毫秒数

-XX:GCTimeRatio：设置垃圾收集时间占总时间的比率，0 &lt; n &lt; 100的整数；计算公式为 垃圾收集时间：1 / (1 + n)

-XX:+UseAdptiveSizePolicy：动态调整这些参数，以提供最合适的停顿时间或最大的吞吐量。调整内容有 新生代的大小（-Xmn）、Eden与Survivor区的比例（-XX:SurvivorRation）、晋升老年代的对象年龄（-XX:PretenureSizeThreshold）等</code></pre><h4 id="工作流程-2"><a href="#工作流程-2" class="headerlink" title="工作流程"></a>工作流程</h4><p><img alt="parallel scavenge垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/parallel_scavenge_collection.webp" class="lozad"></p>
<h2 id="老年代垃圾回收器"><a href="#老年代垃圾回收器" class="headerlink" title="老年代垃圾回收器"></a>老年代垃圾回收器</h2><h3 id="serial-old"><a href="#serial-old" class="headerlink" title="serial old"></a>serial old</h3><h4 id="简单介绍-3"><a href="#简单介绍-3" class="headerlink" title="简单介绍"></a>简单介绍</h4><ul>
<li>Serial Old是 Serial收集器的老年代版本；</li>
<li>采用<code>标记-整理</code>算法</li>
</ul>
<h4 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h4><ul>
<li>在客户端模式下，虚拟机的老年代区域</li>
<li>在服务器端：<ul>
<li>与par scavenge收集器搭配使用</li>
<li>作为cms的后备方案。在发生 Concurrent Mode Failure 时使用</li>
</ul>
</li>
</ul>
<h4 id="工作流程-3"><a href="#工作流程-3" class="headerlink" title="工作流程"></a>工作流程</h4><p><img alt="serial old垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/serial_old_collection.webp" class="lozad"></p>
<h3 id="parallel-old"><a href="#parallel-old" class="headerlink" title="parallel old"></a>parallel old</h3><h4 id="简单介绍-4"><a href="#简单介绍-4" class="headerlink" title="简单介绍"></a>简单介绍</h4><ul>
<li>Parallel Old垃圾收集器是Parallel Scavenge收集器的老年代版本</li>
<li>采用<code>标记-整理</code>算法</li>
</ul>
<h4 id="适用场景-4"><a href="#适用场景-4" class="headerlink" title="适用场景"></a>适用场景</h4><p>server模式、多cpu的情况下，可以起到高吞吐量的效果</p>
<h4 id="参数设置-3"><a href="#参数设置-3" class="headerlink" title="参数设置"></a>参数设置</h4><pre><code>-XX:+UseParallelOldGC：指定使用Parallel Old收集器。java8中默认适用该收集器。</code></pre><h4 id="工作流程-4"><a href="#工作流程-4" class="headerlink" title="工作流程"></a>工作流程</h4><p><img alt="parallel old垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/parallel_old_collection.webp" class="lozad"></p>
<h3 id="cms"><a href="#cms" class="headerlink" title="cms"></a>cms</h3><h4 id="简单介绍-5"><a href="#简单介绍-5" class="headerlink" title="简单介绍"></a>简单介绍</h4><ul>
<li>并行：用户线程&amp;垃圾收集线程可同时进行</li>
<li>采用<code>标记-清除</code>算法</li>
<li>目的：追求垃圾收集停顿时间短</li>
<li>会产生浮动垃圾：因为用户线程和垃圾回收线程同时进行，所以会产生新的垃圾无法标记收集，这种情景下，如果剩余的内存空间不足浮动垃圾存储，就会导致 Concurrent Mode Failure 错误<ul>
<li>参数设置：-XX:CMSInitiatingOccupancyFraction：设置CMS预留内存空间，java6开始默认 92%</li>
</ul>
</li>
<li>存在内存碎片：这是标记清除的问题，可以通过参数设置进行调整<ul>
<li>-XX:+UseCMSCompactAtFullCollection：是否进行内存碎片整理，这个过程会很耗时，默认开启，但还需要结合下面参数</li>
<li>-XX:+CMSFullGCsBeforeCompaction：设置多少次full gc后，进行内存碎片整理。默认为0，即不进行</li>
</ul>
</li>
</ul>
<h4 id="适用场景-5"><a href="#适用场景-5" class="headerlink" title="适用场景"></a>适用场景</h4><p>希望用户交互好的场景。web服务常用</p>
<h4 id="参数设置-4"><a href="#参数设置-4" class="headerlink" title="参数设置"></a>参数设置</h4><p>-XX:+UseConcMarkSweepGC：指定使用CMS收集器</p>
<h4 id="工作流程-5"><a href="#工作流程-5" class="headerlink" title="工作流程"></a>工作流程</h4><p>cms工作流程较复杂，主要分四步</p>
<table>
<thead>
<tr>
<th>步骤</th>
<th>操作</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>初始标记</td>
<td>仅标记gc root直接关联的对象</td>
<td>- 速度快 - stw</td>
</tr>
<tr>
<td>并发标记</td>
<td>从gc root开始标记所有的存活对象</td>
<td>- 耗时 - 用户线程和收集线程并行执行 - 单线程标记：只开一个线程标记</td>
</tr>
<tr>
<td>重新标记</td>
<td>修正 并行标记变动对象的 标记记录</td>
<td>- 速度慢 - stw - 多线程</td>
</tr>
<tr>
<td>并发清除</td>
<td>清除垃圾</td>
<td>- 耗时 - 用户线程和收集线程并行 - 单线程</td>
</tr>
</tbody></table>
<p><img alt="cms垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/cms_collection.webp" class="lozad"></p>
<h3 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h3><h4 id="简单介绍-6"><a href="#简单介绍-6" class="headerlink" title="简单介绍"></a>简单介绍</h4><ul>
<li>region做为垃圾回收最小单位，堆内存最多允许2048个region，每个region大小默认的计算方式是用堆大小/2048 = 每个region的大小，也可手动设置 -XX:G1HeapRegionSize</li>
<li>新生代和老年代是逻辑概念<ul>
<li>新生代还是区分 Eden区 和 Survivor区，因为采用的还是复制算法</li>
<li>进入老年代的时机和其他垃圾回收器一样</li>
</ul>
</li>
<li>新生代默认初始占堆的5%，会动态变化，默认最大不超过堆的 60%，超过了就会进行新生代的垃圾回收</li>
<li>通过对每个region追踪回收价值（即每个region有多少垃圾，回收需要多长时间），可让用户设置<code>垃圾回收所需时间</code>，用于提高用户的交互性。这是G1最大的特性</li>
<li>当对象大小大于单个region的50%，标记为大对象，大对象会有专门的大对象存储region（每个region不会固定属性，会动态变化其属于新生代还是老年代）</li>
<li>采用什么垃圾算法<ul>
<li>全局看是标记-整理 算法（理解：如果局部都采用复制算法，其实全局看是类似标记整理算法的）</li>
<li>局部看是 复制 算法</li>
</ul>
</li>
<li>Remember set：用于记录哪些region对象引用了本region里的对象，该方案可以在老年代扫描中减少扫描时间</li>
<li>新生代和老年代的GC<ul>
<li>Cset：代表需要回收的目标分区。每次暂停垃圾回收时，会把Cset分区释放，并把存活对象分配到空闲分区（对于新生代和老年代都一样，就是<code>复制算法</code>）。年轻代有年轻代的Cset，混合收集时，会把收益最高的分区放入Cset</li>
<li>新生代：当Eden区内存不足时，会把Eden区存活对象移向Survivor（和其他垃圾回收器一样）</li>
<li>老年代：当老年代占用空间大于堆的45%时，进行<code>混合收集</code>，但不会把垃圾全部回收（因为要达到设置的垃圾回收所需时间），会依赖两个值进行回收<ul>
<li>垃圾回收的最大总次数：-XX:G1MixedGCCountTarget（默认为8）即把垃圾回收分成几次进行回收</li>
<li>堆废物百分比：-XX:G1HeapWastePercent（默认5%）即把废物垃圾百分比占到该比例不再进行混合回收</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="适用场景-6"><a href="#适用场景-6" class="headerlink" title="适用场景"></a>适用场景</h4><p>针对服务器端的大内存、多cpu机器和服务</p>
<p>在下面的情况时，使用G1可能比CMS好：</p>
<p>  （1）超过50％的Java堆被活动数据占用：对于cms 内存会经常满，需要进行full gc</p>
<p>  （2）对象分配频率或年代提升频率变化很大：对于cms 当内存过大，每次full gc会耗时长</p>
<p>  （3）GC停顿时间过长（长于0.5至1秒）：对于g1 可以根据价值进行回收</p>
<h4 id="工作流程-6"><a href="#工作流程-6" class="headerlink" title="工作流程"></a>工作流程</h4><table>
<thead>
<tr>
<th>步骤</th>
<th>操作</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>初始标记</td>
<td>记录直接引用</td>
<td>- stw - 单线程 - 速度快</td>
</tr>
<tr>
<td>并发标记</td>
<td>可达性分析</td>
<td>- 用户线程和收集线程并行 - 单线程</td>
</tr>
<tr>
<td>最终标记</td>
<td>修正 对象变化 的标记（记录到Rset）</td>
<td>- stw - 多线程</td>
</tr>
<tr>
<td>筛选回收</td>
<td>根据价值进行筛选回收</td>
<td>- stw - 回收效率高 - 多线程</td>
</tr>
</tbody></table>
<p><img alt="G1垃圾回收器" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/G1_collection.webp" class="lozad"></p>
<h4 id="G1垃圾回收过程"><a href="#G1垃圾回收过程" class="headerlink" title="G1垃圾回收过程"></a>G1垃圾回收过程</h4><p>因为G1的垃圾回收触发机制和回收机制和其他垃圾回收器不太一致，所以特此写下流程</p>
<ul>
<li>如果新生代未达到60%，老年代未达到45%，系统正常运行</li>
<li>如果新生代达到60%，新对象进入新生代，Eden装不下，触发ygc（复制算法）</li>
<li>对象一直进入新生代，当以下情况进入老年代<ul>
<li>年龄达15岁（可设置）</li>
<li>ygc后存活对象放不进survivor区</li>
<li>survior区大小大于50%（可设置），最大年龄的到老年代</li>
</ul>
</li>
<li>当老年代的占比内存达45%，进行mixed垃圾回收</li>
<li>以上过程都是先进行复制算法进行垃圾回收，当出现实在没有空闲内存时，会触发full gc，具体原因：<ul>
<li>新生代拷贝存活对象，找不到空闲区域</li>
<li>老年代拷贝存活对象，招不到空闲区域</li>
<li>分配巨型对象招不到连续内存空间</li>
</ul>
</li>
<li>full gc会适用serial old进行垃圾回收</li>
</ul>
<p><a href="https://www.cnblogs.com/alsf/p/9484770.html" target="_blank" rel="noopener">参考</a><br><a href="https://www.jianshu.com/p/e5d2435a9122" target="_blank" rel="noopener">参考</a><br><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html" target="_blank" rel="noopener">参考:oracle jvm官网介绍</a><br><a href="https://blog.csdn.net/coderlius/article/details/79272773" target="_blank" rel="noopener">参考</a></p>
<hr>
<center>创作不易，谢谢你的支持~~</center>
<center class="half">
    <img width="300" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/wechat_shikai.jpg" class="lozad">
    <img width="300" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/alipay_shikai.jpg" class="lozad">
</center></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">精进马大使</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://jskblog.xyz/posts/62a5eeb2/">http://jskblog.xyz/posts/62a5eeb2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://jskblog.xyz">精进马大使</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/jvm/">jvm    </a><a class="post-meta__tags" href="/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8/">垃圾回收器    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/wechat_shikai.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/alipay_shikai.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/posts/1a869dfe/"><img class="prev_cover lozad" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>jvm区域划分及存放数据</span></div></a></div><div class="next-post pull-right"><a href="/posts/a1f3afe4/"><img class="next_cover lozad" data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/java_photo.gif" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>java对象内存计算</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/545f0a8f/" title="JVM类加载器和对象生成过程"><img class="relatedPosts_cover lozad"data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg"><div class="relatedPosts_title">JVM类加载器和对象生成过程</div></a></div><div class="relatedPosts_item"><a href="/posts/1a869dfe/" title="jvm区域划分及存放数据"><img class="relatedPosts_cover lozad"data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg"><div class="relatedPosts_title">jvm区域划分及存放数据</div></a></div><div class="relatedPosts_item"><a href="/posts/a1f3afe4/" title="java对象内存计算"><img class="relatedPosts_cover lozad"data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/java_photo.gif"><div class="relatedPosts_title">java对象内存计算</div></a></div><div class="relatedPosts_item"><a href="/posts/48f0de66/" title="JVM常量池分类及介绍"><img class="relatedPosts_cover lozad"data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg"><div class="relatedPosts_title">JVM常量池分类及介绍</div></a></div><div class="relatedPosts_item"><a href="/posts/91f0cf3/" title="JVM OOM 汇总及介绍"><img class="relatedPosts_cover lozad"data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg"><div class="relatedPosts_title">JVM OOM 汇总及介绍</div></a></div><div class="relatedPosts_item"><a href="/posts/de2d575e/" title="jvm知识汇总"><img class="relatedPosts_cover lozad"data-src="https://cdn.jsdelivr.net/gh/JSK520/blog_web@1.1/photos/jingjin_1.jpg"><div class="relatedPosts_title">jvm知识汇总</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'SWSiPXFxVqui6FGyRkPnCH8H-gzGzoHsz',
  appKey:'6CXuzjRmitpm3VEYvkC1uO2b',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'30',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></div><footer><div id="footer"><div class="copyright">&copy;2019 - 2020 By 精进马大使</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="nightshift fa fa-moon-o" id="nightshift" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/local-search.js"></script><script src="/js/nightshift.js"></script><script color="0,0,255" opacity="0.7" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/js/canvas-nest.js"></script><script src="/js/baidupush.js"> </script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script>const observer = lozad(); // lazy loads elements with default selector as '.lozad'
observer.observe();
</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>